---
title: '**BI 306 R Tutorial: Part 1**'
date: "*Fall 2021*"
output: 
  html_document:
    theme: cosmo
    highlight: tango
---

<br/>

Before you begin, you will need to download the following:   

* R software [here](https://archive.linux.duke.edu/cran/) for your computer   
* RStudio [here](https://www.rstudio.com/products/rstudio/download/#download)   

<br/>


Quick notes on this document:

* Blue text can be clicked on to access the associated link (for example, you can click [this](https://www.ipcc.ch) to link to the latest IPCC report)
* Text with grey shaded background represents R objects or commands in line with main text like this: ```2 + 2```
* Some code chunks are missing code where you can apply what you have learned. Those will have hashed (```#```) out comments in them with instructions to help you write the appropriate code.


<br/>


## **Getting started with R**

To begin, we will be working with one of the built-in datasets in R called ```iris``` that contains the sepal and petal widths and lengths of different iris species ([you can read more about this dataset here](https://en.wikipedia.org/wiki/Iris_flower_data_set)). 

```{r}

## Load the iris dataset that is included in R
data("iris")

```

After loading the data, we can see what is actually included in the data using the ```head()``` function.

```{r}

head(iris)

```

The ```head()``` function will display the top six rows of data (you can modify this to show, for example, the top 3 rows like this ```head(iris, 3) ```). This is a nice way to get a sense of what your data look like. We can now see that the ```iris``` dataset contains four columns containing data for sepal length, sepal width, petal length, petal width, and species. These columns contain different types of data that we can understand a bit better by using the ```str()``` function to view the *structure* of the data.

```{r}

str(iris)

```

From this function, we can now see that the ```iris``` dataset is a ```data.frame``` object, it contains 150 observations (or rows of data), and 5 variables (columns). Additionally, the function displays the type of data in each column (identified after the ```$```) and first few observations. We see that the first four columns all contain numeric (```num```) values while the last column (```Species```) contains factors with three different levels (these levels are the different types of species within that column).

<br/>

## **Downloading and loading packages**

R comes with a lot of functions already included that you can use for your analyses, however, there are so many powerful and helpful packages out there that include additional functions that you will likely want to use. For example, we will want to calculate some simple summary statistics on the ```iris``` data and the package ```Rmisc``` contains a helpful function ```summarySE()``` that can accomplish this. In order to use this function, you will need to download this package. Most R packages can be easily downloaded in RStudio from the packages tab in the lower right panel or using the command ```install.packages()```. To practice, go ahead and download the ```Rmisc``` package using the command below.
```{r echo = TRUE, results = 'hide', eval = FALSE}

## Download the Rmisc package from CRAN
install.packages("Rmisc")

```

Once you have installed the package (*you only need to do this once or if you update your R version*), you need to load that package using the function ```library()``` or ```source()``` before you can use any of the included functions.
```{r message=FALSE}

## Load the Rmisc package before using it
library(Rmisc)

```

Great! You now have the ```Rmisc``` package installed and loaded in your current RStudio session. While you only need to install a package once, you will need to load the package every time you begin a new session and want to use those functions. 

<br/>

**Helpful tip**: If you are using a package for the first time or are looking for helpful information about the functions within a package, you can view the documentation for that package by running the following code with the name of the package you are interested in.
```{r}

## View the documentation associated with the Rmisc package
help(package = "Rmisc")

```

<br/>

## **Simply summary statistics**

Once you know what the structure ```str()``` of your data looks like, it is also good to look at some basic summary statistics. There are many different ways to calculate summary statistics in R, but here we will explore two different methods using different R packages.

### **Method 1**: summarySE()
The first method will use the function ```summarySE()``` within the R package ```Rmisc``` installed and loaded above. This function can calculate the sample size, mean, standard deviation, standard error, and confidence intervals for your data (you can read details on the function [here](https://www.rdocumentation.org/packages/Rmisc/versions/1.5/topics/summarySE)). 

This function requires the user to input some information so the function knows how to calculate the summary statistics so we will first break down all the arguments that need to (or can be) specified. Here is what the function looks like: **```summarySE(data = NULL, measurevar, groupvars = NULL, na.rm = FALSE, conf.interval = 0.95)```**

<center>
argument | definition
:-------- | :----------------------------------
data | a data frame
measurevar | the name of a column that contains the variable to be summariezed
groupvars | a vector containing names of columns that contain grouping variables
na.rm | whether to ignore NA's in your data (TRue = NA's ignored)
conf.interval | percent range of the confidence interval (default is 95%)
</center>

<br/>

If we want to measure the summary statistics of the measured ```Sepal.Length``` by ```Species``` in the ```iris``` dataset, we would fill in the following into the function:

```{r}

summarySE(data = iris, measurevar = "Sepal.Length", groupvars = "Species", na.rm = TRUE)

```

This output now shows grouping variable (```groupvars```) ```Species``` as the first column, followed by the number of observations within each species (sample size; ```N```), the calculated mean length (notice that the mean column is given the same name as the measured variable -- ```measurevar = "Sepal.Length"```), standard deviation (```sd```) of each species, standard error (```se```), and the 95% confidence interval (```ci```).

**NOTE**: We do not need to specify ```conf.interval = 0.95``` in the function call because the default for this function is to calculate the 95% confidence interval. If we wanted to calculate the 85% confidence interval, we would need to add ```conf.interval = 0.85``` within the function. Try it and see what happens!

```{r}

## Try it: calculate the 85% confidence interval for Sepal Length per Species
# summarySE() function


```

<br/>

Now that we can calculate the summary statistics of the ```Sepal.Length``` per ```Species```, we should assign this function output so that we can come back to it later for things such as plotting it as a figure. To assign this, we simply need to give the output from the function a name. R object names should not contain spaces and are case sensitive. It is best to use underscores (```_```) to separate words in object naming if you must (instead of ```-``` or ```.```). Here, we will name our summary results ```sepal_length_sum```. When assigning objects to names, we first provide the name (```sepal_length_sum```), followed by the left assignment (```<-```), and then what we want to be saved with the name (here it is the ```summarSE()``` results).

```{r}

sepal_length_sum <- summarySE(data = iris, measurevar = "Sepal.Length", groupvars = "Species", na.rm = TRUE)

```

Notice that R did not print the results from the function in the same way it did earlier. This is because you have assigned the object to a name. If you want to view the results after assigning the name, you now just need to run the name assigned to the output like so:

```{r}

sepal_length_sum

```

<br/>


### **Method 2**: Tidyverse
The second method we will use will rely on  ```tidyverse``` syntax. This is a really useful collection of R packages that are designed for data science and make your code very clean for other people to understand. This method will require a bit more effort up front, but is more flexible than using the ```summarySE()``` function.   

Start by installing and loading the ```tidyverse``` package.
```{r echo = TRUE, results = 'hide', eval = FALSE}

## You do this one! How do you install the tidyverse package? Add the code below.
# install package
install.packages("tidyverse")

```

```{r echo=TRUE, message=FALSE, results=FALSE}

## How do you load the tidyverse package? Add the code below.
# load package
library(tidyverse)

```

Once you have ```tidyverse``` installed and loaded, we can build the code to calculate some summary statistics. Just like when we use the function  ```summarySE()```, we need to specify how we want the data to be grouped for calculating the mean and other statistics. Above we grouped by ```Species ``` so we will do that again here with the ```group_by()``` function. In addition to defining the grouping variable, we then need to add a function that we want to apply to the data. For now, we will just calculate the mean ```Sepal.Length``` per ```Species``` like above. To calculate mean in the tidyverse, we use the ```summarise()``` function ([you can read more about it here](https://www.rdocumentation.org/packages/dplyr/versions/0.7.8/topics/summarise)). Within the ```summarise()``` function, you can pass a summary function, such as the ```mean``` function, and name that column something (here we are naming it ```mean_SepLength```).   

We will add these functions to our data (```iris```) using the pipe (``` %>%```) operator. This pipe has been defined in the tidyverse to pipe a value forward into a function like below. We can pipe several functions together for our desired outcome, which is why using tidyverse syntax produces fairly clean code.

```{r warning=FALSE}

iris %>% 
  group_by(Species) %>% 
  summarise(mean_SepLength = mean(Sepal.Length, na.rm = TRUE))

```




```{r}

#iris %>% 
#  group_by(Treatment, nutrients, exp) %>% # input your grouping variable (seperate by commas if more than one)
#  summarise(mean = round(mean(Sample.weight.postburn..g., na.rm = TRUE), 2),
#            max = round(max(Sample.weight.postburn..g., na.rm = TRUE), 2),
#            min = round(min(Sample.weight.postburn..g., na.rm = TRUE), 2),
#            sd = sd(Sample.weight.postburn..g., na.rm = TRUE),
#            n = n()) %>% 
#  mutate(se = sd / sqrt(n),
#         lowerci = mean - qt(1 - (0.05 / 2), n - 1) * se,
#         upperci = mean + qt(1 - (0.05 / 2), n - 1) * se)
#
```


<br/>

## **Helpful resources**

* [R tutorial with links to other tutorials/resources](https://github.com/MoteCHaDlab/IntroGitHubandR/tree/main/R)
* [R Markdown cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)
* [Data visualization with ggplot2 cheatsheet](https://hbctraining.github.io/Intro-to-R-flipped/cheatsheets/data-visualization-2.1.pdf)
* [Base R cheat sheet](https://iqss.github.io/dss-workshops/R/Rintro/base-r-cheat-sheet.pdf)
* [A bunch of R cheat sheets](https://www.rstudio.com/resources/cheatsheets/)


